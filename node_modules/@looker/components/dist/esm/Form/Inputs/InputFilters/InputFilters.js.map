{"version":3,"file":"InputFilters.js","names":["styled","React","useMemo","useState","useRef","Close","FilterList","Select","InputText","inputTextFocus","inputCSS","Icon","IconButton","Chip","Text","Popover","PopoverContent","useTranslation","InputFiltersChip","inputFilterEditor","InputFiltersLayout","_ref","className","filters","hideFilterIcon","onChange","props","_objectWithoutProperties","_excluded","t","placeholder","fieldEditing","setFieldEditing","undefined","assignedFilters","filter","value","field","sort","a","b","unassignedFilters","map","assigned","includes","filterTerm","setFilterTerm","options","reduce","acc","option","label","optionMatchesFilter","Object","values","some","toLocaleLowerCase","indexOf","inputRef","isClearable","length","clearFilters","_ref2","rest","_excluded2","focusInput","current","focus","handleFilterLookupChange","find","createElement","onClick","color","mr","mt","icon","size","ChipWrapper","i","editor","editFilter","handleDelete","currentFilter","_value","_excluded3","setFieldEditingValue","filterIndex","findIndex","f","newFilters","updateFilter","_objectSpread","closeEditor","filterToken","key","onDelete","fontSize","lineHeight","content","filterOptions","isOpen","placement","setOpen","autoResize","openOnFocus","indicator","onFilter","isFilterable","ref","ml","div","withConfig","displayName","componentId","_t","_","theme","space","u1","InputFilters","_t2","u05","u2"],"sources":["../../../../../src/Form/Inputs/InputFilters/InputFilters.tsx"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2022 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nimport styled from 'styled-components';\nimport React, { useMemo, useState, useRef } from 'react';\nimport { Close } from '@styled-icons/material/Close';\nimport { FilterList } from '@styled-icons/material/FilterList';\nimport type { SelectOptionObject } from '../Select';\nimport { Select } from '../Select';\nimport { InputText, inputTextFocus, inputCSS } from '../InputText';\nimport { Icon } from '../../../Icon';\nimport { IconButton } from '../../../Button';\nimport { Chip } from '../../../Chip';\nimport { Text } from '../../../Text';\nimport { Popover, PopoverContent } from '../../../Popover';\nimport { useTranslation } from '../../../utils';\nimport { InputFiltersChip } from './InputFiltersChip';\nimport { inputFilterEditor } from './inputFilterEditor';\nimport type { InputFiltersProps } from './types';\n\nconst InputFiltersLayout = ({\n  className,\n  filters,\n  hideFilterIcon = false,\n  onChange,\n  ...props\n}: InputFiltersProps) => {\n  const { t } = useTranslation('InputFilters');\n  const placeholder = props.placeholder || t('Filter List');\n  const [fieldEditing, setFieldEditing] = useState<undefined | string>(\n    undefined\n  );\n\n  const assignedFilters = filters\n    .filter(filter => filter.value || filter.field === fieldEditing)\n    .sort((a, b) => {\n      if (a.value === undefined) {\n        return 1;\n      } else if (b.value === undefined) {\n        return -1;\n      } else {\n        return 0;\n      }\n    });\n\n  const unassignedFilters = filters.filter(\n    filter =>\n      !assignedFilters.map(assigned => assigned.field).includes(filter.field)\n  );\n\n  const [filterTerm, setFilterTerm] = useState('');\n\n  const options = useMemo(\n    () =>\n      unassignedFilters.reduce((acc: SelectOptionObject[], filter) => {\n        const option = {\n          label: filter.label || filter.field,\n          value: filter.field,\n        };\n        const optionMatchesFilter = Object.values(option).some(\n          (value: string) =>\n            value.toLocaleLowerCase().indexOf(filterTerm.toLocaleLowerCase()) >\n            -1\n        );\n        if (optionMatchesFilter) {\n          acc = [...acc, option];\n        }\n        return acc;\n      }, []),\n    [filterTerm, unassignedFilters]\n  );\n\n  const inputRef = useRef<null | HTMLInputElement>(null);\n  const isClearable = assignedFilters.length > 0;\n\n  const clearFilters = () => {\n    onChange(filters.map(({ value, ...rest }) => rest));\n  };\n\n  const focusInput = () => inputRef.current && inputRef.current.focus();\n\n  const handleFilterLookupChange = (field: string) => {\n    const filter = filters.find(option => option.field === field);\n    if (filter) {\n      setFieldEditing(filter.field);\n    }\n  };\n\n  return (\n    <div className={className} onClick={focusInput}>\n      {!hideFilterIcon && (\n        <Icon\n          color=\"ui4\"\n          mr=\"xsmall\"\n          mt=\"xxsmall\"\n          icon={<FilterList />}\n          size={20}\n        />\n      )}\n      <ChipWrapper>\n        {assignedFilters.map((filter, i) => {\n          const { editor, field, value } = filter;\n\n          const editFilter = () => setFieldEditing(field);\n\n          const handleDelete = () =>\n            onChange(\n              filters.map(currentFilter => {\n                if (currentFilter.field !== field) {\n                  return currentFilter;\n                }\n                const { value: _value, ...rest } = currentFilter;\n                return rest;\n              })\n            );\n\n          const setFieldEditingValue = (value?: string) => {\n            const filterIndex = assignedFilters.findIndex(\n              f => f.field === fieldEditing\n            );\n\n            const newFilters = [...assignedFilters, ...unassignedFilters];\n            const updateFilter = { ...newFilters[filterIndex], value };\n            newFilters[filterIndex] = updateFilter;\n\n            onChange(newFilters);\n          };\n\n          const closeEditor = () => setFieldEditing(undefined);\n\n          const filterToken = value ? (\n            <InputFiltersChip\n              filter={filter}\n              key={i}\n              onClick={editFilter}\n              onDelete={handleDelete}\n            />\n          ) : (\n            <Text fontSize=\"small\" lineHeight=\"xlarge\">\n              {filter?.label || filter.field}:\n            </Text>\n          );\n          return filter.field === fieldEditing ? (\n            <Popover\n              content={\n                <PopoverContent>\n                  {editor\n                    ? editor({\n                        closeEditor,\n                        filterOptions: filter,\n                        onChange: setFieldEditingValue,\n                        value,\n                      })\n                    : inputFilterEditor({\n                        closeEditor,\n                        filterOptions: filter,\n                        onChange: setFieldEditingValue,\n                        value,\n                      })}\n                </PopoverContent>\n              }\n              isOpen={fieldEditing !== undefined}\n              key={i}\n              placement=\"bottom-start\"\n              setOpen={closeEditor}\n            >\n              {filterToken}\n            </Popover>\n          ) : (\n            filterToken\n          );\n        })}\n        {!fieldEditing && (\n          <Select\n            autoResize\n            openOnFocus\n            indicator={false}\n            onFilter={setFilterTerm}\n            isFilterable\n            onChange={handleFilterLookupChange}\n            options={options}\n            placeholder={placeholder}\n            ref={inputRef}\n          />\n        )}\n      </ChipWrapper>\n      {isClearable && (\n        <IconButton\n          icon={<Close />}\n          label={t('Clear Filters')}\n          ml=\"auto\"\n          mt=\"xxsmall\"\n          mr=\"xsmall\"\n          onClick={clearFilters}\n          size=\"xsmall\"\n        />\n      )}\n    </div>\n  );\n};\n\nconst ChipWrapper = styled.div`\n  display: inline-flex;\n  flex: 1;\n  flex-wrap: wrap;\n\n  @supports (gap: 4px) {\n    gap: ${({ theme }) => theme.space.u1};\n    ${Chip} {\n      margin: 0;\n    }\n  }\n`;\n\nexport const InputFilters = styled(InputFiltersLayout)`\n  ${inputCSS}\n  align-items: start;\n  display: flex;\n  flex-wrap: wrap;\n  padding: ${({ theme: { space } }) => space.u05} 0;\n  padding-left: ${({ theme: { space } }) => space.u2};\n  width: 100%;\n  &:focus-within {\n    ${inputTextFocus}\n  }\n\n  ${Select} {\n    margin-left: ${({ theme: { space } }) => space.u1};\n  }\n\n  ${Select} ${Icon} {\n    display: none;\n  }\n\n  ${InputText} {\n    border: none;\n    height: 30px;\n    padding: 0;\n\n    &:focus-within {\n      box-shadow: none;\n    }\n\n    input {\n      padding: 0;\n    }\n  }\n`;\n"],"mappings":"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"}