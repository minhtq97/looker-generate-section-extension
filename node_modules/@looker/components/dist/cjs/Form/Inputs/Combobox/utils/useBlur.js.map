{"version":3,"file":"useBlur.js","names":["_react","require","_state","useBlur","context","_useContext","useContext","inputValue","data","state","transition","listRef","inputElement","freeInputPropRef","shouldRenderListInline","closeList","action","payload","current","undefined","handleBlur","e","ComboboxState","IDLE","ComboboxActionType","ESCAPE","nextFocusTarget","relatedTarget","popoverCurrent","focusInList","contains","INTERACTING","INTERACT","BLUR","preventDefault"],"sources":["../../../../../../src/Form/Inputs/Combobox/utils/useBlur.ts"],"sourcesContent":["/**\n * Copyright (c) 2023 Google LLC\n * SPDX-License-Identifier: MIT\n */\n\n// Much of the following is pulled from https://github.com/reach/reach-ui\n// because their work is fantastic (but is not in TypeScript)\nimport type { Context, FocusEvent } from 'react';\nimport { useContext } from 'react';\nimport type {\n  ComboboxContextProps,\n  ComboboxMultiContextProps,\n} from '../ComboboxContext';\nimport { ComboboxActionType, ComboboxState } from './state';\n\nexport function useBlur<\n  TContext extends\n    | ComboboxContextProps\n    | ComboboxMultiContextProps = ComboboxContextProps\n>(context: Context<TContext>) {\n  const {\n    data: { inputValue },\n    state,\n    transition,\n    listRef,\n    inputElement,\n    freeInputPropRef,\n    shouldRenderListInline,\n  } = useContext(context);\n\n  function closeList(action: ComboboxActionType) {\n    // When freeInput is true, the current inputValue should not be changed on blur\n    // (for Multi, InputChips will tokenize the inputValue on blur)\n    const payload =\n      freeInputPropRef && freeInputPropRef.current ? { inputValue } : undefined;\n\n    transition && transition(action, payload);\n  }\n\n  return function handleBlur(e?: FocusEvent) {\n    if (!e) {\n      // handleBlur was called directly (via popover close)\n      // only need to close the list\n      if (!shouldRenderListInline && state !== ComboboxState.IDLE) {\n        closeList(ComboboxActionType.ESCAPE);\n      }\n      return;\n    }\n    // we on want to close only if focus rests outside the select\n    const nextFocusTarget = e.relatedTarget;\n    const popoverCurrent = listRef ? listRef.current : null;\n    if (popoverCurrent) {\n      const focusInList =\n        popoverCurrent && popoverCurrent.contains(nextFocusTarget);\n\n      if (focusInList && state !== ComboboxState.INTERACTING) {\n        // focus landed inside the select, keep it open\n        transition && transition(ComboboxActionType.INTERACT);\n      } else if (!focusInList && nextFocusTarget !== inputElement) {\n        // focus landed outside the select, close it\n        closeList(ComboboxActionType.BLUR);\n      }\n      // Stop ComboboxMultiInput + freeInput underlying InputChips blur handler from\n      // tokenizing input value when an option is clicked\n      focusInList &&\n        freeInputPropRef &&\n        freeInputPropRef.current &&\n        e.preventDefault();\n    }\n  };\n}\n"],"mappings":";;;;;;AAQA,IAAAA,MAAA,GAAAC,OAAA;AAKA,IAAAC,MAAA,GAAAD,OAAA;AAEO,SAASE,OAAOA,CAIrBC,OAA0B,EAAE;EAC5B,IAAAC,WAAA,GAQI,IAAAC,iBAAU,EAACF,OAAO,CAAC;IAPbG,UAAU,GAAAF,WAAA,CAAlBG,IAAI,CAAID,UAAU;IAClBE,KAAK,GAAAJ,WAAA,CAALI,KAAK;IACLC,UAAU,GAAAL,WAAA,CAAVK,UAAU;IACVC,OAAO,GAAAN,WAAA,CAAPM,OAAO;IACPC,YAAY,GAAAP,WAAA,CAAZO,YAAY;IACZC,gBAAgB,GAAAR,WAAA,CAAhBQ,gBAAgB;IAChBC,sBAAsB,GAAAT,WAAA,CAAtBS,sBAAsB;EAGxB,SAASC,SAASA,CAACC,MAA0B,EAAE;IAG7C,IAAMC,OAAO,GACXJ,gBAAgB,IAAIA,gBAAgB,CAACK,OAAO,GAAG;MAAEX,UAAU,EAAVA;IAAW,CAAC,GAAGY,SAAS;IAE3ET,UAAU,IAAIA,UAAU,CAACM,MAAM,EAAEC,OAAO,CAAC;EAC3C;EAEA,OAAO,SAASG,UAAUA,CAACC,CAAc,EAAE;IACzC,IAAI,CAACA,CAAC,EAAE;MAGN,IAAI,CAACP,sBAAsB,IAAIL,KAAK,KAAKa,oBAAa,CAACC,IAAI,EAAE;QAC3DR,SAAS,CAACS,yBAAkB,CAACC,MAAM,CAAC;MACtC;MACA;IACF;IAEA,IAAMC,eAAe,GAAGL,CAAC,CAACM,aAAa;IACvC,IAAMC,cAAc,GAAGjB,OAAO,GAAGA,OAAO,CAACO,OAAO,GAAG,IAAI;IACvD,IAAIU,cAAc,EAAE;MAClB,IAAMC,WAAW,GACfD,cAAc,IAAIA,cAAc,CAACE,QAAQ,CAACJ,eAAe,CAAC;MAE5D,IAAIG,WAAW,IAAIpB,KAAK,KAAKa,oBAAa,CAACS,WAAW,EAAE;QAEtDrB,UAAU,IAAIA,UAAU,CAACc,yBAAkB,CAACQ,QAAQ,CAAC;MACvD,CAAC,MAAM,IAAI,CAACH,WAAW,IAAIH,eAAe,KAAKd,YAAY,EAAE;QAE3DG,SAAS,CAACS,yBAAkB,CAACS,IAAI,CAAC;MACpC;MAGAJ,WAAW,IACThB,gBAAgB,IAChBA,gBAAgB,CAACK,OAAO,IACxBG,CAAC,CAACa,cAAc,CAAC,CAAC;IACtB;EACF,CAAC;AACH"}